(function(){var e=this,t=function(e,t,n,i){if(!e||!t)return e;t.properties||(t={properties:t});var r={},s=function(e,t){var a=null,o=null;if(!e||e!==Object(e))return null;if(e.required){if(e.default)return void(r[t]=e.default);i||("object"===e.type||e.properties?r[t]={}:"array"===e.type||e.items?r[t]=[]:"string"===e.type?r[t]="":"number"===e.type||"integer"===e.type?r[t]=0:"boolean"===e.type?r[t]=!1:r[t]={})}else if(e.default&&n)return void(r[t]=e.default);if(a=e.properties,a)for(var d in a)a.hasOwnProperty(d)&&s(a[d],t+"."+d);e.items&&(o=e.items,l(o)&&(o=o[0]),s(o,t+"[]"))};for(var o in s(t,""),r)r.hasOwnProperty(o)&&a(e,o,r[o])},n=function(e,t){var n=t.replace(/\./g,".properties.").replace(/\[.*\](\.|$)/g,".items$1"),a=i(e,n);return a?a.default:null},i=function(e,t){for(var n=e,i=t.split("."),a=null,r=null,s=/\[([0-9]*)\](?:\.|$)/,o=0;o<i.length;o++){if("object"!=typeof n)return null;if(a=i[o],r=a.match(s),r){if(a=a.replace(s,""),!l(n[a]))return null;n=n[a][parseInt(r[1],10)]}else n=n[a]}return n},a=function(e,t,n){var i=t.split("."),a=function(e,t,n){var i=null,r=/\[([0-9]*)\]$/,s=t.shift(),o=0;if(t.length>0){if(i=s.match(r),i){if(s=s.replace(r,""),l(e[s])||(e[s]=[]),e=e[s],""!==i[1])o=parseInt(i[1],10),e[o]||(e[o]={}),a(e[o],t,n);else for(var d=0;d<e.length;d++)a(e[d],t,n);return}"object"!=typeof e[s]&&(e[s]={}),e=e[s],a(e,t,n)}else i=s.match(r),i?(s=s.replace(r,""),l(e[s])||(e[s]=[]),o=parseInt(i[1],10),e[s][o]||(e[s][o]=n)):e[s]||(e[s]=n)};i[0]||i.shift(),a(e,i,n)},l=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)};"undefined"!=typeof define?define([],function(){return{setDefaultValues:t,setObjKey:a,getSchemaKeyDefaultValue:n}}):"undefined"!=typeof module&&module.exports?module.exports={setDefaultValues:t,setObjKey:a,getSchemaKeyDefaultValue:n}:(e.JSONForm=e.JSONForm||{},e.JSONForm.setDefaultValues=t,e.JSONForm.setObjKey=a,e.JSONForm.getSchemaKeyDefaultValue=n)})(),function(e,t,n){e&&!n&&(n=require("underscore"));var i=function(e,t,i){if(i=i||{},t=t||[],!e||!e.form)return{included:{},excluded:{}};n.isString(t)&&(t=[t]);var a={included:{schema:{properties:{}},form:[]},excluded:{schema:{properties:{}},form:[]}};n.each(e,function(e,t){"schema"!==t&&"form"!==t&&(a.included[t]=e,a.excluded[t]=e)});var l=function(e){var i=n.isString(e)?e:e.key;return!!i&&(n.include(t,i)||!!n.find(t,function(e){return 0===i.indexOf(e+".")||0===i.indexOf(e+"[]")}))},r=function(e){var i=n.isString(e)?e:e.key;return!!i&&(!n.include(t,i)&&!n.find(t,function(e){return 0===i.indexOf(e+".")||0===i.indexOf(e+"[]")}))},s=function(e){return l(e)||e.items&&!!n.some(e.items,function(e){return s(e)})},o=function(e){return r(e)||e.items&&!!n.some(e.items,function(e){return o(e)})},d=function(e,t,a){var l=null,r=e.root||"all"===t||a&&a.key&&"selectfieldset"===a.type||e.type&&"help"===e.type;if(r||(r="included"===t&&s(e)),r||(r="excluded"===t&&o(e),r&&!i.excludeCoupledKeys&&(r=!s(e))),!r)return null;var m=t;return"included"!==m||i.excludeCoupledKeys||e.root||(m="all"),l=n.clone(e),l.items&&(l.items=n.map(l.items,function(e){return d(e,m,l)}),l.items=n.compact(l.items)),l},m=function(e,t){return!!e&&(!!t&&(n.isString(e)?e===t||0===e.indexOf(t+".")||0===e.indexOf(t+"[]"):!(!e.key||e.key!==t&&0!==e.key.indexOf(t+".")&&0!==e.key.indexOf(t+"[]"))||!!n.some(e.items,function(e){return m(e,t)})))},u=null;u=d({items:e.form,root:!0},"included"),u&&(a.included.form=u.items),u=d({items:e.form,root:!0},"excluded"),u&&(a.excluded.form=u.items);var h=e.schema;return h.properties&&(h=h.properties),n.each(h,function(e,t){n.some(a.included.form,function(e){return m(e,t)})?a.included.schema.properties[t]=e:a.excluded.schema.properties[t]=e}),a};t.JSONForm=t.JSONForm||{},t.JSONForm.split=i}("undefined"!=typeof exports,"undefined"!=typeof exports?exports:window,"undefined"!=typeof _?_:null),function(e,t,n,i,a){e&&!i&&(i=require("underscore"));var l=/\[([0-9]*)\](?=\[|\.|$)/g,r={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},s={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},o=function(e){return!(i.isUndefined(e)||i.isNull(e))},d=function(e,t){return"object"==typeof e&&e.hasOwnProperty(t)},m={util:{}},u=function(e){return o(e)?(e=""+e,e?e.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""):""},h=function(e){return e.replace(/([ \!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;<\=\>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")},c=function(e){return e.replace(/\ /g,"_")},f=function(e){var t=function(e,t){t.find("> .active").removeClass("active"),e.addClass("active")},i=function(e,t){e.find("input, textarea, select").removeAttr("disabled"),e.parent().children(":not([data-idx="+t+"])").find("input, textarea, select").attr("disabled","disabled")},a=function(e){var a,l=n("option:selected",n(this)),r=n(this),s=l.get(0).getAttribute("data-idx")||l.attr("value");e.preventDefault(),l.hasClass("active")||(a=n(this).parents(".tabbable").eq(0).find("> .tab-content > [data-idx="+s+"]"),t(l,r),t(a,a.parent()),i(a,s))},l=function(e){n("a",n(this));var a=n(this).parents(".tabbable").first().find(".tab-content").first(),l=n(this).index(),r=a.find("> [data-idx="+l+"]");e.preventDefault(),t(n(this),n(this).parent()),t(r,r.parent()),n(this).parent().hasClass("jsonform-alternative")&&i(r,l)};e.each(function(){n(this).delegate("select.nav","change",a),n(this).find("select.nav").each(function(){n(this).val(n(this).find(".active").attr("value"));var e=n(this).find("option:selected").get(0).getAttribute("data-idx")||n(this).find("option:selected").attr("value"),t=n(this).parents(".tabbable").eq(0).find("> .tab-content > [data-idx="+e+"]");i(t,e)}),n(this).delegate("ul.nav li","click",l),n(this).find("ul.nav li.active").click()})};m.fieldTemplate=function(e){return'<div <% for(var key in elt.htmlMetaData) {%><%= key %>="<%= elt.htmlMetaData[key] %>" <% }%>class="form-group jsonform-error-<%= keydash %><%= elt.htmlClass ? " " + elt.htmlClass : "" %><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " jsonform-required" : "") %><%= (node.readOnly ? " jsonform-readonly" : "") %><%= (node.disabled ? " jsonform-disabled" : "") %>"><% if (!elt.notitle) { %><label for="<%= node.id %>"><%= node.title ? node.title : node.name %></label><% } %><div class="controls"><% if (node.prepend || node.append) { %><div class="<% if (node.prepend) { %>input-group<% } %><% if (node.append) { %> input-group<% } %>"><% if (node.prepend) { %><span class="input-group-addon"><%= node.prepend %></span><% } %><% } %>'+e+'<% if (node.append) { %><span class="input-group-addon"><%= node.append %></span><% } %><% if (node.prepend || node.append) { %></div><% } %><% if (node.description) { %><span class="help-block"><%= node.description %></span><% } %><span class="help-block jsonform-errortext" style="display:none;"></span></div></div>'};var p='<div class="_jsonform-preview"><% if (value.type=="image") { %><img class="jsonform-preview" id="jsonformpreview-<%= id %>" src="<%= value.url %>" /><% } else { %><a href="<%= value.url %>"><%= value.name %></a> (<%= Math.ceil(value.size/1024) %>kB)<% } %></div><a href="#" class="btn btn-default _jsonform-delete"><i class="glyphicon glyphicon-remove" title="Remove"></i></a> ',v=function(e){return{template:'<input type="'+e+'" class=\'form-control<%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\'name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && (node.schemaElement.step > 0 || node.schemaElement.step == "any") ? " step=\'" + node.schemaElement.step + "\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%> />',fieldtemplate:!0,inputfield:!0}};m.elementTypes={none:{template:""},root:{template:"<div><%= children %></div>"},text:v("text"),password:v("password"),date:v("date"),datetime:v("datetime"),"datetime-local":v("datetime-local"),email:v("email"),month:v("month"),number:v("number"),search:v("search"),tel:v("tel"),time:v("time"),url:v("url"),week:v("week"),range:{template:'<div class="range"><input type="range" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%> min=<%= range.min %> max=<%= range.max %> step=<%= range.step %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %> /><% if (range.indicator) { %><span class="range-value" rel="<%= id %>"><%= escape(value) %></span><% } %></div>',fieldtemplate:!0,inputfield:!0,onInput:function(e,t){const n=document.querySelector('span.range-value[rel="'+t.id+'"]');n&&(n.innerText=e.target.value)},onBeforeRender:function(e,t){e.range={min:1,max:100,step:1,indicator:!1},t&&t.schemaElement&&(t.formElement&&t.formElement.step&&(e.range.step=t.formElement.step),t.formElement&&t.formElement.indicator&&(e.range.indicator=t.formElement.indicator),void 0!==t.schemaElement.minimum&&(t.schemaElement.exclusiveMinimum?e.range.min=t.schemaElement.minimum+e.range.step:e.range.min=t.schemaElement.minimum),void 0!==t.schemaElement.maximum&&(t.schemaElement.exclusiveMaximum?e.range.max=t.schemaElement.maximum-e.range.step:e.range.max=t.schemaElement.maximum))}},color:{template:'<input type="text" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %> />',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){n(t.el).find("#"+h(t.id)).spectrum({preferredFormat:"hex",showInput:!0})}},textarea:{template:'<textarea id="<%= id %>" name="<%= node.name %>" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>style="height:<%= elt.height || "150px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0},wysihtml5:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %><%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var i=function(){n(t.el).data("wysihtml5")||(n(t.el).data("wysihtml5_loaded",!0),n(t.el).find("#"+h(t.id)).wysihtml5({html:!0,link:!0,"font-styles":!0,image:!1,events:{load:function(){n(this.textareaElement).removeAttr("required")}}}))};if(window.jsonform_wysihtml5_setup)window.jsonform_wysihtml5_setup(i);else var a=window.setInterval(function(){window.wysihtml5&&(window.clearInterval(a),i())},1e3)}},ace:{template:'<div id="<%= id %>" style="position:relative;height:<%= elt.height || "300px" %>;"><div id="<%= id %>__ace" style="width:<%= elt.width || "100%" %>;height:<%= elt.height || "300px" %>;"></div><input type="hidden" name="<%= node.name %>" id="<%= id %>__hidden" value="<%= escape(value) %>"/></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var a=function(){var e=t.formElement||{},a=window.ace,l=a.edit(n(t.el).find("#"+h(t.id)+"__ace").get(0)),r="#"+h(t.id)+"__hidden";l.getSession().setNewLineMode("unix"),l.renderer.setShowPrintMargin(!1),l.setTheme("ace/theme/"+(e.aceTheme||"twilight")),e.aceMode&&l.getSession().setMode("ace/mode/"+e.aceMode),l.getSession().setTabSize(2),l.getSession().setValue(t.value||"");var s=i.debounce(function(){n(t.el).find(r).val(l.getSession().getValue()),n(t.el).find(r).change()},600);l.getSession().on("change",s),l.on("blur",function(){n(t.el).find(r).change(),n(t.el).find(r).trigger("blur")}),l.on("focus",function(){n(t.el).find(r).trigger("focus")})};if(window.jsonform_ace_setup)window.jsonform_ace_setup(a);else var l=window.setInterval(function(){window.ace&&(window.clearInterval(l),a())},1e3)}},checkbox:{template:'<div class="checkbox"><label><input type="checkbox" id="<%= id %>" <%= (fieldHtmlClass ? " class=\'" + fieldHtmlClass + "\'": "") %>name="<%= node.name %>" value="1" <% if (value) {%>checked<% } %><%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %> /><%= node.inlinetitle || "" %></label></div>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return n(e).parent().get(0)}},file:{template:'<input class="input-file" id="<%= id %>" name="<%= node.name %>" type="file" <%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %><%= (node.formElement && node.formElement.accept ? (" accept=\'" + node.formElement.accept + "\'") : "") %>/>',fieldtemplate:!0,inputfield:!0},"file-hosted-public":{template:"<span><% if (value && (value.type||value.url)) { %>"+p+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="<%= transloaditname %>" /><input data-transloadit-name="_transloadit_<%= transloaditname %>" type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return n(e).parent().get(0)},onBeforeRender:function(e,t){t.ownerTree._transloadit_generic_public_index?t.ownerTree._transloadit_generic_public_index++:t.ownerTree._transloadit_generic_public_index=1,e.transloaditname="_transloadit_jsonform_genericupload_public_"+t.ownerTree._transloadit_generic_public_index,t.ownerTree._transloadit_generic_elts||(t.ownerTree._transloadit_generic_elts={}),t.ownerTree._transloadit_generic_elts[e.transloaditname]=t},onChange:function(e,t){if(t.ownerTree._transloadit_bound)return!1;t.ownerTree._transloadit_bound=!0;var l=n(t.ownerTree.domRoot);l.transloadit({autoSubmit:!1,wait:!0,onSuccess:function(e){var n=i.values(e.results);n=i.flatten(n),i.each(n,function(e){var n=t.ownerTree._transloadit_generic_elts[e.field].id,r=l.find("#"+h(n)),s=i.filter(i.keys(e.meta),function(t){return!!o(e.meta[t])});e.meta=i.pick(e.meta,s),r.val(a.stringify(e))}),t.ownerTree._transloadit_bound=!1,l.unbind("submit.transloadit"),i.delay(function(){t.ownerTree.submit()},10)},onError:function(e){console.log("assembly error",e)}})},onInsert:function(e,t){n(t.el).find("a._jsonform-delete").on("click",function(e){return n(t.el).find("._jsonform-preview").remove(),n(t.el).find("a._jsonform-delete").remove(),n(t.el).find("#"+h(t.id)).val(""),e.preventDefault(),!1})},onSubmit:function(e,t){return!t.ownerTree._transloadit_bound}},"file-transloadit":{template:"<span><% if (value && (value.type||value.url)) { %>"+p+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="_transloadit_<%= node.name %>" /><input type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return n(e).parent().get(0)},onChange:function(e,t){if(t.ownerTree._transloadit_bound)return!1;t.ownerTree._transloadit_bound=!0;var l=n(t.ownerTree.domRoot);l.transloadit({autoSubmit:!1,wait:!0,onSuccess:function(e){var n=i.values(e.results);n=i.flatten(n),i.each(n,function(e){var t=l.find('input[name="'+e.field.replace(/^_transloadit_/,"")+'"]'),n=i.filter(i.keys(e.meta),function(t){return!!o(e.meta[t])});e.meta=i.pick(e.meta,n),t.val(a.stringify(e))}),t.ownerTree._transloadit_bound=!1,l.unbind("submit.transloadit"),i.delay(function(){t.ownerTree.submit()},10)},onError:function(e){console.log("assembly error",e)}})},onInsert:function(e,t){n(t.el).find("a._jsonform-delete").on("click",function(e){return n(t.el).find("._jsonform-preview").remove(),n(t.el).find("a._jsonform-delete").remove(),n(t.el).find("#"+h(t.id)).val(""),e.preventDefault(),!1})},onSubmit:function(e,t){return!t.ownerTree._transloadit_bound}},select:{template:'<select name="<%= node.name %>" id="<%= id %>"class=\'form-control<%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\'<%= (node.schemaElement && node.schemaElement.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %>> <% _.each(node.options, function(key, val) { if(key instanceof Object) { if (value === key.value) { %> <option selected value="<%= key.value %>"><%= key.title %></option> <% } else { %> <option value="<%= key.value %>"><%= key.title %></option> <% }} else { if (value === key) { %> <option selected value="<%= key %>"><%= key %></option> <% } else { %><option value="<%= key %>"><%= key %></option> <% }}}); %> </select>',fieldtemplate:!0,inputfield:!0},imageselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn<% if (buttonClass && node.value) { %> <%= buttonClass %><% } else { %> btn-default<% } %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><img src="<% if (!node.value.match(/^https?:/)) { %><%= prefix %><% } %><%= node.value %><%= suffix %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu navbar" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } else { %> btn-default<% } %>" style="max-width:<%= width %>px;max-height:<%= height %>px"><% if (key instanceof Object) { %><img src="<% if (!key.value.match(/^https?:/)) { %><%= prefix %><% } %><%= key.value %><%= suffix %>" alt="<%= key.title %>" /></a><% } else { %><img src="<% if (!key.match(/^https?:/)) { %><%= prefix %><% } %><%= key %><%= suffix %>" alt="" /><% } %></a> <% }); %></div><div class="pagination-right"><a class="btn btn-default">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n=t.formElement||{},i=null,a=n.imageSelectorColumns||5;e.buttonTitle=n.imageSelectorTitle||"Select...",e.prefix=n.imagePrefix||"",e.suffix=n.imageSuffix||"",e.width=n.imageWidth||32,e.height=n.imageHeight||32,e.buttonClass=n.imageButtonClass||!1,t.options.length>a?(i=Math.ceil(t.options.length/a),e.columns=Math.ceil(t.options.length/i)):e.columns=a},getElement:function(e){return n(e).parent().get(0)},onInsert:function(e,t){n(t.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var i="img"===e.target.nodeName.toLowerCase()?n(e.target):n(e.target).find("img"),a=i.attr("src"),l=t.formElement||{},r=l.imagePrefix||"",s=l.imageSuffix||"",o=l.imageWidth||32,d=l.imageHeight||32;a?(0===a.indexOf(r)&&(a=a.substring(r.length)),a=a.substring(0,a.length-s.length),n(t.el).find("input").attr("value",a),n(t.el).find('a[data-toggle="dropdown"]').addClass(l.imageButtonClass).attr("style","max-width:"+o+"px;max-height:"+d+"px").html('<img src="'+(a.match(/^https?:/)?"":r)+a+s+'" alt="" />')):(n(t.el).find("input").attr("value",""),n(t.el).find('a[data-toggle="dropdown"]').removeClass(l.imageButtonClass).removeAttr("style").html(l.imageSelectorTitle||"Select..."))})}},iconselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn<% if (buttonClass && node.value) { %> <%= buttonClass %><% } %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><i class="icon-<%= node.value %>" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu navbar" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } %>" ><% if (key instanceof Object) { %><i class="icon-<%= key.value %>" alt="<%= key.title %>" /></a><% } else { %><i class="icon-<%= key %>" alt="" /><% } %></a> <% }); %></div><div class="pagination-right"><a class="btn">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n=t.formElement||{},i=null,a=n.imageSelectorColumns||5;e.buttonTitle=n.imageSelectorTitle||"Select...",e.buttonClass=n.imageButtonClass||!1,t.options.length>a?(i=Math.ceil(t.options.length/a),e.columns=Math.ceil(t.options.length/i)):e.columns=a},getElement:function(e){return n(e).parent().get(0)},onInsert:function(e,t){n(t.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var i="i"===e.target.nodeName.toLowerCase()?n(e.target):n(e.target).find("i"),a=i.attr("class"),l=t.formElement||{};a?(a=a,n(t.el).find("input").attr("value",a),n(t.el).find('a[data-toggle="dropdown"]').addClass(l.imageButtonClass).html('<i class="'+a+'" alt="" />')):(n(t.el).find("input").attr("value",""),n(t.el).find('a[data-toggle="dropdown"]').removeClass(l.imageButtonClass).html(l.imageSelectorTitle||"Select..."))})}},radios:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><div class="radio"><label><input<%= (fieldHtmlClass ? " class=\'" + fieldHtmlClass + "\'": "") %> type="radio" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>"<%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %>/><%= (key instanceof Object ? key.title : key) %></label></div> <% }); %></div>',fieldtemplate:!0,inputfield:!0},radiobuttons:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><label class="btn btn-default <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>active btn-success<% } %>"><input<%= (fieldHtmlClass ? " class=\'" + fieldHtmlClass + "\'": "") %> type="radio" style="position:absolute;left:-9999px;" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>" /><span><%= (key instanceof Object ? key.title : key) %></span></label> <% }); %></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var i="active",a=t.formElement||{};a.activeClass&&(i+=" "+a.activeClass),n(t.el).find("label").on("click",function(){n(this).parent().find("label").removeClass(i),n(this).addClass(i)})}},checkboxes:{template:"<div><%= choiceshtml %></div>",fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n=null,a=null,l='<div class="checkbox"><label><input type="checkbox" <% if (value) { %> checked="checked" <% } %> name="<%= name %>" value="1"<%= (node.disabled? " disabled" : "")%>/><%= title %></label></div>';t&&t.schemaElement&&(n=t.schemaElement.items?t.schemaElement.items.enum||t.schemaElement.items[0].enum:t.schemaElement.enum,n&&(a="",i.each(n,function(e,n){a+=i.template(l,r)({name:t.key+"["+n+"]",value:i.include(t.value,e),title:d(t.formElement.titleMap,e)?t.formElement.titleMap[e]:e,node:t})}),e.choiceshtml=a))}},array:{template:'<div id="<%= id %>"><ul class="_jsonform-array-ul" style="list-style-type:none;"><%= children %></ul><span class="_jsonform-array-buttons"><a href="#" class="btn btn-default _jsonform-array-addmore"><i class="glyphicon glyphicon-plus-sign" title="Add new"></i></a> <a href="#" class="btn btn-default _jsonform-array-deletelast"><i class="glyphicon glyphicon-minus-sign" title="Delete last"></i></a></span></div>',fieldtemplate:!0,array:!0,childTemplate:function(e,t){return n("").sortable?'<li data-idx="<%= node.childPos %>">'+(t?'<span class="draggable line"><i class="glyphicon glyphicon-list" title="Move item"></i></span>':"")+e+"</li>":'<li data-idx="<%= node.childPos %>">'+e+"</li>"},onInsert:function(e,t){var i=n(t.el).find("#"+h(t.id)),a=t.getArrayBoundaries(),l=function(e,a){if(e!==a){var l=e<a?1:-1,r=0,s=n("> ul",i);for(r=e;r!==a;r+=l)t.children[r].switchValuesWith(t.children[r+l]),t.children[r].render(s.get(0)),t.children[r+l].render(s.get(0));var o=n(t.children[e].el),d=n(t.children[a].el);o.detach(),d.detach(),e<a?(0===e?s.prepend(o):n(t.children[e-1].el).after(o),n(t.children[a-1].el).after(d)):(0===a?s.prepend(d):n(t.children[a-1].el).after(d),n(t.children[e-1].el).after(o))}};n("> span > a._jsonform-array-addmore",i).click(function(e){e.preventDefault(),e.stopPropagation();var l=t.children.length;if(a.maxItems>=0&&(t.children.length>a.maxItems-2&&i.find("> span > a._jsonform-array-addmore").addClass("disabled"),t.children.length>a.maxItems-1))return!1;t.insertArrayItem(l,n("> ul",i).get(0)),(a.minItems<=0||a.minItems>0&&t.children.length>a.minItems-1)&&i.find("> span > a._jsonform-array-deletelast").removeClass("disabled")});var r=n("> ul > li",i).length;if(a.minItems>0&&r<a.minItems)for(var s=0;s<a.minItems-1&&i.find("> ul > li").length<a.minItems;s++)t.insertArrayItem(r,i.find("> ul").get(0));a.minItems>0&&t.children.length<=a.minItems&&i.find("> span > a._jsonform-array-deletelast").addClass("disabled"),n("> span > a._jsonform-array-deletelast",i).click(function(e){var n=t.children.length-1;if(e.preventDefault(),e.stopPropagation(),a.minItems>0){if(t.children.length<a.minItems+2&&i.find("> span > a._jsonform-array-deletelast").addClass("disabled"),t.children.length<=a.minItems)return!1}else 1===t.children.length&&i.find("> span > a._jsonform-array-deletelast").addClass("disabled");t.deleteArrayItem(n),a.maxItems>=0&&n<=a.maxItems-1&&i.find("> span > a._jsonform-array-addmore").removeClass("disabled")}),o(t.formElement.draggable)&&!t.formElement.draggable||n(t.el).sortable&&(n("> ul",i).sortable(),n("> ul",i).bind("sortstop",function(e,t){var i=n(t.item).data("idx"),a=n(t.item).index();l(i,a)}))}},tabarray:{template:'<div id="<%= id %>"><div class="tabbable tabs-left"><ul class="nav nav-tabs"><%= tabs %></ul><div class="tab-content"><%= children %></div></div><a href="#" class="btn btn-default _jsonform-array-addmore"><i class="glyphicon glyphicon-plus-sign" title="Add new"></i></a> <a href="#" class="btn btn-default _jsonform-array-deleteitem"><i class="glyphicon glyphicon-minus-sign" title="Delete item"></i></a></div>',fieldtemplate:!0,array:!0,childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane">'+e+"</div>"},onBeforeRender:function(e,t){var n="";i.each(t.children,function(e,t){var i=e.legend||e.title||"Item "+(t+1);n+='<li data-idx="'+t+'"'+(0===t?' class="active"':"")+'><a class="draggable tab" data-toggle="tab" rel="'+escape(i)+'">'+u(i)+"</a></li>"}),e.tabs=n},onInsert:function(e,t){var a=n(t.el).find("#"+h(t.id)),l=t.getArrayBoundaries(),r=function(e,i){if(e!==i){var l=e<i?1:-1,r=0,s=n("> .tabbable > .tab-content",a).get(0);for(r=e;r!==i;r+=l)t.children[r].switchValuesWith(t.children[r+l]),t.children[r].render(s),t.children[r+l].render(s)}},s=function(e){var l="",r=!1;void 0===e&&(e=n("> .tabbable > .nav-tabs .active",a).data("idx"),e?e=parseInt(e,10):(r=!0,e=0)),e>=t.children.length&&(e=t.children.length-1),i.each(t.children,function(e,t){n('> .tabbable > .tab-content > [data-idx="'+t+'"] > fieldset > legend',a).html(e.legend);var i=e.legend||e.title||"Item "+(t+1);l+='<li data-idx="'+t+'"><a class="draggable tab" data-toggle="tab" rel="'+escape(i)+'">'+u(i)+"</a></li>"}),n("> .tabbable > .nav-tabs",a).html(l),r&&n('> .tabbable > .nav-tabs [data-idx="0"]',a).addClass("active"),n('> .tabbable > .nav-tabs [data-toggle="tab"]',a).eq(e).click()};if(n("> a._jsonform-array-deleteitem",a).click(function(e){var i=n("> .tabbable > .nav-tabs .active",a).data("idx");if(e.preventDefault(),e.stopPropagation(),l.minItems>0&&(t.children.length<l.minItems+1&&a.find("> a._jsonform-array-deleteitem").addClass("disabled"),t.children.length<=l.minItems))return!1;t.deleteArrayItem(i),s(),(t.children.length<l.minItems+1||0===t.children.length)&&a.find("> a._jsonform-array-deleteitem").addClass("disabled"),l.maxItems>=0&&t.children.length<=l.maxItems&&a.find("> a._jsonform-array-addmore").removeClass("disabled")}),n("> a._jsonform-array-addmore",a).click(function(e){var i=t.children.length;if(l.maxItems>=0&&(t.children.length>l.maxItems-2&&n("> a._jsonform-array-addmore",a).addClass("disabled"),t.children.length>l.maxItems-1))return!1;e.preventDefault(),e.stopPropagation(),t.insertArrayItem(i,a.find("> .tabbable > .tab-content").get(0)),s(i),(l.minItems<=0||l.minItems>0&&i>l.minItems-1)&&a.find("> a._jsonform-array-deleteitem").removeClass("disabled")}),n(t.el).on("legendUpdated",function(e){s(),e.preventDefault(),e.stopPropagation()}),o(t.formElement.draggable)&&!t.formElement.draggable||n(t.el).sortable&&(n("> .tabbable > .nav-tabs",a).sortable({containment:t.el,tolerance:"pointer"}),n("> .tabbable > .nav-tabs",a).bind("sortstop",function(e,t){var i=n(t.item).data("idx"),a=n(t.item).index();r(i,a),s(a)})),l.minItems>=0&&t.children.length<=l.minItems){for(var d=0;d<l.minItems-1;d++)a.find("> a._jsonform-array-addmore").click();a.find("> a._jsonform-array-deleteitem").addClass("disabled"),s()}l.maxItems>=0&&t.children.length>=l.maxItems&&a.find("> a._jsonform-array-addmore").addClass("disabled"),l.minItems>=0&&t.children.length<=l.minItems&&a.find("> a._jsonform-array-deleteitem").addClass("disabled")}},help:{template:'<span class="help-block" style="padding-top:5px"><%= elt.helpvalue %></span>',fieldtemplate:!0},msg:{template:"<%= elt.msg %>"},fieldset:{template:'<fieldset class="form-group jsonform-error-<%= keydash %> <% if (elt.expandable) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>" <% if (id) { %> id="<%= id %>"<% } %>><% if (node.title || node.legend) { %><legend role="treeitem" aria-expanded="false"><%= node.title || node.legend %></legend><% } %><% if (elt.expandable) { %><div class="form-group"><% } %><%= children %><% if (elt.expandable) { %></div><% } %></fieldset>',onInsert:function(e,t){null!==t.el&&(n(".expandable > div, .expandable > fieldset",t.el).hide(),n(".expandable",t.el).removeClass("expanded"))}},advancedfieldset:{
template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable <%= elt.htmlClass?elt.htmlClass:"" %>"><legend role="treeitem" aria-expanded="false"><%= (node.title || node.legend) ? (node.title || node.legend) : "Advanced options" %></legend><div class="form-group"><%= children %></div></fieldset>',onInsert:function(e,t){null!==t.el&&(n(".expandable > div, .expandable > fieldset",t.el).hide(),n(".expandable",t.el).removeClass("expanded"))}},authfieldset:{template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable <%= elt.htmlClass?elt.htmlClass:"" %>"><legend role="treeitem" aria-expanded="false"><%= (node.title || node.legend) ? (node.title || node.legend) : "Authentication settings" %></legend><div class="form-group"><%= children %></div></fieldset>',onInsert:function(e,t){null!==t.el&&(n(".expandable > div, .expandable > fieldset",t.el).hide(),n(".expandable",t.el).removeClass("expanded"))}},submit:{template:'<input type="submit" <% if (id) { %> id="<%= id %>" <% } %> class="btn btn-primary <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},button:{template:' <button type="button" <% if (id) { %> id="<%= id %>" <% } %> class="btn btn-default <%= elt.htmlClass?elt.htmlClass:"" %>"><%= node.title %></button> '},actions:{template:'<div class="<%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},hidden:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="<%= escape(value) %>" />',inputfield:!0},tabs:{template:'<ul class="nav nav-tabs <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (elt.id) { %> id="<%= elt.id %>"<% } %>><%=tab_list%></ul><div class="tab-content" <% if (elt.id) { %> data-tabset="<%= elt.id %>"<% } %>><%=children%></div>',getElement:function(e){return n(e).parent().get(0)},onBeforeRender:function(e,t){var n=u(t.id?t.id+"-":""),a="";return i.each(t.children,function(e,t){var i=u(e.title||"Item "+(t+1)),l=i.replace(" ","_");a+='<li class="nav-item'+(0===t?" active":"")+'"><a href="#'+n+l+'" class="nav-link" data-tab="'+n+l+'" data-toggle="tab">'+i+"</a></li>"}),e.tab_list=a,e},onInsert:function(e,t){n("#"+t.id+">li.nav-item").on("click",function(e){e.preventDefault(),n(t.el).find("div[data-tabset='"+t.id+"']>div.tab-pane.active").each(function(){n(this).removeClass("active")});var i=n(this).find("a").attr("data-tab");n("#"+i).addClass("active")})}},tab:{template:'<div class="tab-pane<% if (elt.htmlClass) { %> <%= elt.htmlClass %> <% } %><% if (node.childPos === 0) { %> active<% } %>"<% if (node.title) { %> id="<%= node.parentNode.id %>-<%= node.title.replace(" ","_") %>"<% } %>><%= children %></div>'},selectfieldset:{template:'<fieldset class="tab-container <%= elt.htmlClass?elt.htmlClass:"" %>"><% if (node.legend) { %><legend role="treeitem" aria-expanded="false"><%= node.legend %></legend><% } %><% if (node.formElement.key) { %><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><% } else { %><a id="<%= node.id %>"></a><% } %><div class="tabbable"><div class="form-group<%= node.formElement.hideMenu ? " hide" : "" %>"><% if (!elt.notitle) { %><label for="<%= node.id %>"><%= node.title ? node.title : node.name %></label><% } %><div class="controls"><%= tabs %></div></div><div class="tab-content"><%= children %></div></div></fieldset>',inputfield:!0,getElement:function(e){return n(e).parent().get(0)},childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane<% if (node.active) { %> active<% } %>">'+e+"</div>"},onBeforeRender:function(e,t){var n=null,a=[];t.schemaElement&&(a=t.schemaElement.enum||[]),n=t.options?i.map(t.options,function(e,n){var l=t.children[n];return l.childPos=n,e instanceof Object?(e=i.extend({node:l},e),e.title=e.title||l.legend||l.title||"Option "+(l.childPos+1),e.value=o(e.value)?e.value:o(a[n])?a[n]:n,e):{title:e,value:o(a[l.childPos])?a[l.childPos]:l.childPos,node:l}}):i.map(t.children,function(e,t){return e.childPos=t,{title:e.legend||e.title||"Option "+(e.childPos+1),value:a[e.childPos]||e.childPos,node:e}}),i.each(n,function(e,t){e.node.active=!1});var l=null;e.value&&(l=i.find(n,function(e){return e.value===t.value})),l||(l=i.find(n,function(e){return e.node.hasNonDefaultValue()})),l||(l=n[0]),l.node.active=!0,e.value=l.value;t.formElement;var r='<select class="nav form-control"'+(t.disabled?" disabled":"")+">";return i.each(n,function(e,t){r+='<option data-idx="'+t+'" value="'+e.value+'"'+(e.node.active?' selected="selected" class="active"':"")+">"+u(e.title)+"</option>"}),r+="</select>",e.tabs=r,e},onInsert:function(e,t){n(t.el).find("select.nav").first().on("change",function(e){var i=n(this).find("option:selected");n(t.el).find('input[type="hidden"]').first().val(i.attr("value"))})}},optionfieldset:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},section:{template:'<div<% if (elt.htmlClass) { %> class="<%= elt.htmlClass %>"<% } %><% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},questions:{template:'<div><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><%= children %></div>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return n(e).parent().get(0)},onInsert:function(e,t){t.children&&0!==t.children.length&&(i.each(t.children,function(e){n(e.el).hide()}),n(t.children[0].el).show())}},question:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><label class="<%= (node.formElement.optionsType === "radiobuttons") ? "btn btn-default" : "" %><%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %>"><input type="radio" <% if (node.formElement.optionsType === "radiobuttons") { %> style="position:absolute;left:-9999px;" <% } %>name="<%= node.id %>" value="<%= val %>"<%= (node.disabled? " disabled" : "")%>/><span><%= (key instanceof Object ? key.title : key) %></span></label> <% }); %></div>',fieldtemplate:!0,onInsert:function(e,t){var a="active",l=t.formElement||{};l.activeClass&&(a+=" "+l.activeClass),n(t.el).find('input[type="radio"]').on("change",function(e){var l=null,r=t.options[n(this).val()];t.parentNode&&t.parentNode.el&&(n(this).parent().parent().find("label").removeClass(a),n(this).parent().addClass(a),n(t.el).nextAll().hide(),n(t.el).nextAll().find('input[type="radio"]').prop("checked",!1),r.value&&n(t.parentNode.el).find('input[type="hidden"]').val(r.value),r.next&&(l=i.find(t.parentNode.children,function(e){return e.formElement&&e.formElement.qid===r.next}),n(l.el).show(),n(l.el).nextAll().hide(),n(l.el).nextAll().find('input[type="radio"]').prop("checked",!1)),r.href&&(r.target?window.open(r.href,r.target):window.location=r.href),r.submit&&setTimeout(function(){t.ownerTree.submit()},0))})}}},m.util.getObjKey=function(e,t,n){for(var a=e,r=t.split("."),s=null,o=null,d=null,m=0;m<r.length;m++){if(null===a||"object"!=typeof a)return null;if(s=r[m],d=s.replace(l,""),l.lastIndex=0,o=l.exec(s),o)for(;;){if(d&&!i.isArray(a[d]))return null;if(a=d?a[d][parseInt(o[1])]:a[parseInt(o[1])],o=l.exec(s),!o)break;d=null}else a=n&&!a[d]&&i.isArray(a)&&a[0]?a[0][d]:a[d]}return n&&i.isArray(a)&&a[0]?a[0]:a},m.util.setObjKey=function(e,t,n){for(var a=e,r=t.split("."),s=null,o=null,d=null,m=0;m<r.length-1;m++)if(s=r[m],d=s.replace(l,""),l.lastIndex=0,o=l.exec(s),o){for(;i.isArray(a[d])||(a[d]=[]),a=a[d],d=parseInt(o[1],10),o=l.exec(s),o;);"object"==typeof a[d]&&null!==a[d]||(a[d]={}),a=a[d]}else"object"==typeof a[d]&&null!==a[d]||(a[d]={}),a=a[d];if(s=r[r.length-1],d=s.replace(l,""),l.lastIndex=0,o=l.exec(s),o){for(;i.isArray(a[d])||(a[d]=[]),a=a[d],d=parseInt(o[1],10),o=l.exec(s),o;);a[d]=n}else a[d]=n};var g=function(e,t){var n=t.replace(/\./g,".properties.").replace(/\[[0-9]*\]/g,".items"),i=m.util.getObjKey(e,n,!0);if(i&&i.$ref)throw new Error("JSONForm does not yet support schemas that use the $ref keyword. See: https://github.com/joshfire/jsonform/issues/54");return i},y=function(e,t){var n=0,i=0;if(!e)return null;if(t>0)for(;n<t;){if(i=e.indexOf("[]",i),-1===i)return e;i+=2,n+=1}return i=e.indexOf("[]",i),-1===i?e:e.substring(0,i)},b=function(e,t){var n=0;if(!e)return null;if(!t||0===t.length)return e;var i=e.replace(l,function(e,i){var a=e;return o(t[n])&&(a="["+t[n]+"]"),n+=1,a});return i},x=function(e,t,n,a,l){var r=null;a=a||{},a.idx=a.idx||(n?n[n.length-1]:1),a.value=o(a.value)?a.value:"",a.getValue=a.getValue||function(t){return x(e,t,n,a,l)};var u=function(e,t){var n=null;return e&&e.length?(i.each(e,function(e){n||(e!==t?i.isString(e)||(e.key===t?n=e:e.items&&(n=u(e.items,t))):n={key:e})}),n):null},h=u(e.form||[],t),c=g(e.schema.properties,t);return l&&e.value&&(r=m.util.getObjKey(e.value,b(t,n))),o(r)||(h&&void 0!==h.value?r=h.value:c&&o(c.default)&&(r=c.default),r&&-1!==r.indexOf("{{values.")&&(r=r.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}')),r&&(r=i.template(r,s)(a))),o(r)&&h&&d(h.titleMap,r)&&(r=i.template(h.titleMap[r],s)(a)),r&&i.isString(r)&&c&&c.maxLength&&r.length>c.maxLength&&(r=r.substr(0,c.maxLength-1)+"â€¦"),o(r)?r:null},w=function(){this.id=null,this.key=null,this.el=null,this.formElement=null,this.schemaElement=null,this.view=null,this.children=[],this.ownerTree=null,this.parentNode=null,this.childTemplate=null,this.legendChild=null,this.arrayPath=[],this.childPos=0};w.prototype.clone=function(e){var t=new w;return t.arrayPath=i.clone(this.arrayPath),t.ownerTree=this.ownerTree,t.parentNode=e||this.parentNode,t.formElement=this.formElement,t.schemaElement=this.schemaElement,t.view=this.view,t.children=i.map(this.children,function(e){return e.clone(t)}),this.childTemplate&&(t.childTemplate=this.childTemplate.clone(t)),t},w.prototype.hasNonDefaultValue=function(){if(this.formElement&&"hidden"==this.formElement.type)return!1;if(this.value&&!this.defaultValue)return!0;var e=i.find(this.children,function(e){return e.hasNonDefaultValue()});return!!e},w.prototype.appendChild=function(e){return e.parentNode=this,e.childPos=this.children.length,this.children.push(e),e},w.prototype.removeChild=function(){var e=this.children[this.children.length-1];if(e)return n(e.el).remove(),this.children.pop()},w.prototype.moveValuesTo=function(e){var t=this.getFormValues(e.arrayPath);e.resetValues(),e.computeInitialValues(t,!0)},w.prototype.switchValuesWith=function(e){var t=this.getFormValues(e.arrayPath),n=e.getFormValues(this.arrayPath);e.resetValues(),e.computeInitialValues(t,!0),this.resetValues(),this.computeInitialValues(n,!0)},w.prototype.resetValues=function(){var e=null;if(this.value=null,this.parentNode?(this.arrayPath=i.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],this.view&&this.view.inputfield)e=n(":input",this.el).serializeArray(),i.each(e,function(e){n('[name="'+h(e.name)+'"]',n(this.el)).val("")},this);else if(this.view&&this.view.array)for(;this.children.length>0;)this.removeChild();i.each(this.children,function(e){e.resetValues()})},w.prototype.setChildTemplate=function(e){this.childTemplate=e,e.parentNode=this},w.prototype.computeInitialValues=function(e,t){var n=this,a=null,l=1,r=0,d=this.ownerTree.formDesc.tpldata||{};if(this.parentNode?(this.arrayPath=i.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],d.idx=this.arrayPath.length>0?this.arrayPath[this.arrayPath.length-1]+1:this.childPos+1,d.value="",d.getValue=function(t){if(!e)return"";var i,a=e,l=t.split("[].");for(i=0;i<l.length-1;i++)a=a[l[i]][n.arrayPath[i]];return a[l[i]]},this.formElement&&(this.formElement.id?this.id=b(this.formElement.id,this.arrayPath):this.view&&this.view.array?this.id=h(this.ownerTree.formDesc.prefix)+"-elt-counter-"+i.uniqueId():this.parentNode&&this.parentNode.view&&this.parentNode.view.array?this.id=h(this.ownerTree.formDesc.prefix)+"-elt-counter-"+i.uniqueId():"button"!==this.formElement.type&&"selectfieldset"!==this.formElement.type&&"question"!==this.formElement.type&&"buttonquestion"!==this.formElement.type||(this.id=h(this.ownerTree.formDesc.prefix)+"-elt-counter-"+i.uniqueId()),this.formElement.key&&(this.key=b(this.formElement.key,this.arrayPath),this.keydash=c(this.key.replace(/\./g,"---"))),this.name=b(this.formElement.name,this.arrayPath),i.each(["title","legend","description","append","prepend","inlinetitle","helpvalue","value","disabled","placeholder","readOnly"],function(e){i.isString(this.formElement[e])?(-1!==this.formElement[e].indexOf("{{values.")?this[e]=this.formElement[e].replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this[e]=b(this.formElement[e],this.arrayPath),this[e]&&(this[e]=i.template(this[e],s)(d))):this[e]=this.formElement[e]},this),this.formElement.options&&(this.options=i.map(this.formElement.options,function(e){var t=null;return i.isObject(e)&&e.title?(t=-1!==e.title.indexOf("{{values.")?e.title.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):b(e.title,n.arrayPath),i.extend({},e,{value:o(e.value)?e.value:"",title:i.template(t,s)(d)})):e}))),this.view&&this.view.inputfield&&this.schemaElement)e?o(m.util.getObjKey(e,this.key))?this.value=m.util.getObjKey(e,this.key):o(this.schemaElement.default)&&(this.value=this.schemaElement.default,"string"==typeof this.value&&(this.value=i.template(this.value,s)(d))):t||!o(this.value)&&o(this.schemaElement.default)&&(this.value=this.schemaElement.default,i.isString(this.value)&&(-1!==this.value.indexOf("{{values.")?this.value=this.value.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this.value=b(this.value,this.arrayPath),this.value&&(this.value=i.template(this.value,s)(d))),this.defaultValue=!0);else if(this.view&&this.view.array)for(l=0,e?l=this.getPreviousNumberOfItems(e,this.arrayPath):0===l&&(l=1),r=0;r<l;r++)this.appendChild(this.childTemplate.clone());if(i.each(this.children,function(n){n.computeInitialValues(e,t)}),this.formElement&&this.formElement.valueInLegend)for(a=this;a;){if(a.parentNode&&a.parentNode.view&&a.parentNode.view.array&&(a.legendChild=this,a.formElement&&a.formElement.legend)){a.legend=b(a.formElement.legend,a.arrayPath),d.idx=a.arrayPath.length>0?a.arrayPath[a.arrayPath.length-1]+1:a.childPos+1,d.value=o(this.value)?this.value:"",a.legend=i.template(a.legend,s)(d);break}a=a.parentNode}},w.prototype.getPreviousNumberOfItems=function(e,t){var n=null,a=null,l=null;return e?this.view.inputfield&&this.schemaElement?(n=y(this.formElement.key,t.length),n=b(n,t),a=m.util.getObjKey(e,n),a?(l=i.map(this.children,function(n){return n.getPreviousNumberOfItems(e,t)}),i.max([i.max(l)||0,a.length])):0):this.view.array?this.childTemplate.getPreviousNumberOfItems(e,t):(l=i.map(this.children,function(n){return n.getPreviousNumberOfItems(e,t)}),i.max(l)||0):0},w.prototype.getFormValues=function(e){var t={};if(!this.el)throw new Error("formNode.getFormValues can only be called on nodes that are associated with a DOM element in the tree");var l=n(":input",this.el).serializeArray();l=l.concat(n(":input[type=checkbox]:not(:disabled):not(:checked)",this.el).map(function(){return{name:this.name,value:this.checked}}).get()),e&&i.each(l,function(t){t.name=b(t.name,e)});for(var r=this.ownerTree.formDesc.schema,s=0;s<l.length;s++){var o=l[s].name,d=g(r.properties,o),u=null,h=null;if(d)if(d._jsonform_checkboxes_as_array&&(u=o.match(/\[([0-9]*)\]$/),u))o=o.replace(/\[([0-9]*)\]$/,""),h=m.util.getObjKey(t,o)||[],"1"===l[s].value&&h.push(d.enum[parseInt(u[1],10)]),m.util.setObjKey(t,o,h);else{if("boolean"===d.type&&("0"===l[s].value?l[s].value=!1:l[s].value=!!l[s].value),"number"!==d.type&&"integer"!==d.type||i.isString(l[s].value)&&(l[s].value.length?isNaN(Number(l[s].value))||(l[s].value=Number(l[s].value)):l[s].value=null),"string"!==d.type||""!==l[s].value||d._jsonform_allowEmpty||(l[s].value=null),"object"===d.type&&i.isString(l[s].value)&&"{"===l[s].value.substring(0,1))try{l[s].value=a.parse(l[s].value)}catch(e){l[s].value={}}"object"!==d.type||"null"!==l[s].value&&""!==l[s].value||(l[s].value=null),l[s].name&&null!==l[s].value&&m.util.setObjKey(t,l[s].name,l[s].value)}}return t},w.prototype.render=function(e){var t=this.generate();this.setContent(t,e),this.enhance()},w.prototype.setContent=function(e,t){var i=n(e),a=t||(this.parentNode?this.parentNode.el:this.ownerTree.domRoot),l=null;this.el?n(this.el).replaceWith(i):(l=n(a).children().get(this.childPos),l?n(l).before(i):n(a).append(i)),this.el=i,this.updateElement(this.el)},w.prototype.updateElement=function(e){this.id&&(this.el=n("#"+h(this.id),e).get(0),this.view&&this.view.getElement&&(this.el=this.view.getElement(this.el)),!1!==this.fieldtemplate&&this.view&&this.view.fieldtemplate&&(this.el=n(this.el).parent().parent(),(this.prepend||this.prepend)&&(this.el=this.el.parent()),this.el=this.el.get(0)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(this.el=n(this.el).parent().get(0)));for(const t in this.children)0!=this.children.hasOwnProperty(t)&&this.children[t].updateElement(this.el||e)},w.prototype.generate=function(){var e={id:this.id,keydash:this.keydash,elt:this.formElement,schema:this.schemaElement,node:this,value:o(this.value)?this.value:"",escape:u},t=null,n="";this.ownerTree.formDesc.onBeforeRender&&this.ownerTree.formDesc.onBeforeRender(e,this),this.view.onBeforeRender&&this.view.onBeforeRender(e,this),t=this.template?this.template:this.formElement&&this.formElement.template?this.formElement.template:this.view.template,!1!==this.fieldtemplate&&(this.fieldtemplate||this.view.fieldtemplate)&&(t=m.fieldTemplate(t)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(t=this.parentNode.view.childTemplate(t,!o(this.parentNode.formElement.draggable)||this.parentNode.formElement.draggable));var a="";return i.each(this.children,function(e){a+=e.generate()}),e.children=a,e.fieldHtmlClass="",this.ownerTree&&this.ownerTree.formDesc&&this.ownerTree.formDesc.params&&this.ownerTree.formDesc.params.fieldHtmlClass&&(e.fieldHtmlClass=this.ownerTree.formDesc.params.fieldHtmlClass),this.formElement&&void 0!==this.formElement.fieldHtmlClass&&(e.fieldHtmlClass=this.formElement.fieldHtmlClass),n=i.template(t,r)(e),n},w.prototype.enhance=function(){var e=this,t=null,a=null,l=i.clone(this.ownerTree.formDesc.tpldata)||{};if(this.formElement&&(this.view.onInsert&&this.view.onInsert({target:n(this.el)},this),t=this.handlers||this.formElement.handlers,a=this.onInsert||this.formElement.onInsert,a&&a({target:n(this.el)},this),t&&i.each(t,function(e,t){"insert"===t&&e({target:n(this.el)},this)},this),this.el&&(this.onChange&&n(this.el).bind("change",function(t){e.onChange(t,e)}),this.view.onChange&&n(this.el).bind("change",function(t){e.view.onChange(t,e)}),this.formElement.onChange&&n(this.el).bind("change",function(t){e.formElement.onChange(t,e)}),this.onInput&&n(this.el).bind("input",function(t){e.onInput(t,e)}),this.view.onInput&&n(this.el).bind("input",function(t){e.view.onInput(t,e)}),this.formElement.onInput&&n(this.el).bind("input",function(t){e.formElement.onInput(t,e)}),this.onClick&&n(this.el).bind("click",function(t){e.onClick(t,e)}),this.view.onClick&&n(this.el).bind("click",function(t){e.view.onClick(t,e)}),this.formElement.onClick&&n(this.el).bind("click",function(t){e.formElement.onClick(t,e)}),this.onKeyUp&&n(this.el).bind("keyup",function(t){e.onKeyUp(t,e)}),this.view.onKeyUp&&n(this.el).bind("keyup",function(t){e.view.onKeyUp(t,e)}),this.formElement.onKeyUp&&n(this.el).bind("keyup",function(t){e.formElement.onKeyUp(t,e)}),t&&i.each(t,function(t,i){"insert"!==i&&n(this.el).bind(i,function(n){t(n,e)})},this)),this.legendChild&&this.legendChild.formElement)){var r=function(t){e.formElement&&e.formElement.legend&&e.parentNode&&(e.legend=b(e.formElement.legend,e.arrayPath),l.idx=e.arrayPath.length>0?e.arrayPath[e.arrayPath.length-1]+1:e.childPos+1,l.value=n(t.target).val(),e.legend=i.template(e.legend,s)(l),n(e.parentNode.el).trigger("legendUpdated"))};n(this.legendChild.el).bind("change",r),n(this.legendChild.el).bind("keyup",r)}i.each(this.children,function(e){e.enhance()})},w.prototype.insertArrayItem=function(e,t){var n=0;void 0===e&&(e=this.children.length);var i=this.childTemplate.clone();for(this.appendChild(i),i.resetValues(),n=this.children.length-2;n>=e;n--)this.children[n].moveValuesTo(this.children[n+1]);for(this.children[e].resetValues(),this.children[e].computeInitialValues(),n=e;n<this.children.length;n++)this.children[n].render(t)},w.prototype.deleteArrayItem=function(e){var t=0;for(void 0===e&&(e=this.children.length-1),t=e;t<this.children.length-1;t++)this.children[t+1].moveValuesTo(this.children[t]),this.children[t].render();this.removeChild()},w.prototype.getArrayBoundaries=function(){var e={minItems:-1,maxItems:-1};if(!this.view||!this.view.array)return e;var t=function(e,n){var a=null,l=null,r={minItems:-1,maxItems:-1};return n=n||e,e.view&&e.view.array&&e!==n?r:e.key?(l=e.key.replace(/\[[0-9]+\]/g,"[]"),e!==n&&(l=l.replace(/\[\][^\[\]]*$/,"")),a=g(e.ownerTree.formDesc.schema.properties,l),a?{minItems:a.minItems||a.minLength||-1,maxItems:a.maxItems||a.maxLength||-1}:r):(i.each(e.children,function(e){var i=t(e,n);-1!==i.minItems&&(-1!==r.minItems?r.minItems=Math.max(r.minItems,i.minItems):r.minItems=i.minItems),-1!==i.maxItems&&(-1!==r.maxItems?r.maxItems=Math.min(r.maxItems,i.maxItems):r.maxItems=i.maxItems)}),r)};return t(this)};var E=function(){this.eventhandlers=[],this.root=null,this.formDesc=null};E.prototype.initialize=function(e){e=e||{},this.formDesc=i.clone(e),this.formDesc.prefix=this.formDesc.prefix||"jsonform-"+i.uniqueId(),this.formDesc.schema&&!this.formDesc.schema.properties&&(this.formDesc.schema={properties:this.formDesc.schema}),this.formDesc.form=this.formDesc.form||["*",{type:"actions",items:[{type:"submit",value:"Submit"}]}],this.formDesc.form=i.isArray(this.formDesc.form)?this.formDesc.form:[this.formDesc.form],this.formDesc.params=this.formDesc.params||{},this.root=new w,this.root.ownerTree=this,this.root.view=m.elementTypes.root,this.buildTree(),this.computeInitialValues()},E.prototype.buildTree=function(){i.each(this.formDesc.form,function(e){"*"===e?i.each(this.formDesc.schema.properties,function(e,t){this.root.appendChild(this.buildFromLayout({key:t}))},this):(i.isString(e)&&(e={key:e}),this.root.appendChild(this.buildFromLayout(e)))},this)},E.prototype.buildFromLayout=function(e,t){var n=null,a=new w,l=null,r=null;if(e=i.clone(e),e.items&&(i.isArray(e.items)?e.items=i.map(e.items,i.clone):e.items=[i.clone(e.items)]),e.key){if(n=g(this.formDesc.schema.properties,e.key),!n)throw new Error('The JSONForm object references the schema key "'+e.key+'" but that key does not exist in the JSON schema');if(this.formDesc.onElementSchema&&this.formDesc.onElementSchema(e,n),e.name=e.name||e.key,e.title=e.title||n.title,e.description=e.description||n.description,e.readOnly=e.readOnly||n.readOnly||e.readonly||n.readonly,e.id||(e.id=h(this.formDesc.prefix)+"-elt-"+c(e.key)),e.allowEmpty&&(n._jsonform_allowEmpty=!0),!e.type){if(i.isArray(n.type)){if(i.contains(n.type,"null")&&(n.type=i.without(n.type,"null"),n.required=!1),n.type.length>1)throw new Error("Cannot process schema element with multiple types.");n.type=i.first(n.type)}"string"===n.type&&"color"===n.format?e.type="color":"number"!==n.type&&"integer"!==n.type||n.enum?"string"!==n.type&&"any"!==n.type||n.enum?"boolean"===n.type?e.type="checkbox":"object"===n.type?n.properties?e.type="fieldset":e.type="textarea":i.isUndefined(n.enum)?e.type=n.type:e.type="select":e.type="text":(e.type="number","number"===n.type&&(n.step="any"))}if(!e.options&&n.enum&&(e.titleMap?e.options=i.map(n.enum,function(t){return{value:t,title:d(e.titleMap,t)?e.titleMap[t]:t}}):e.options=n.enum),"checkboxes"===e.type&&n.items){var s=n.items.enum;s&&(n.items._jsonform_checkboxes_as_array=!0),!s&&n.items[0]&&(s=n.items[0].enum,s&&(n.items[0]._jsonform_checkboxes_as_array=!0))}"object"===n.type&&i.each(n.properties,function(t,n){a.appendChild(this.buildFromLayout({key:e.key+"."+n}))},this)}if(e.type||(e.type="none"),l=m.elementTypes[e.type],!l)throw new Error('The JSONForm contains an element whose type is unknown: "'+e.type+'"');if(n){if(!l.inputfield&&!l.array&&"selectfieldset"!==e.type&&"object"!==n.type)throw new Error('The JSONForm contains an element that links to an element in the JSON schema (key: "'+e.key+'") and that should not based on its type ("'+e.type+'")')}else if(l.inputfield&&"selectfieldset"!==e.type)throw new Error('The JSONForm defines an element of type "'+e.type+'" but no "key" property to link the input field to the JSON schema');return e.iddot=h(e.id||""),a.formElement=e,a.schemaElement=n,a.view=l,a.ownerTree=this,e.handlers||(e.handlers={}),a.view.array?(r=e.items?e.items[0]||e.items:e.key+"[]",i.isString(r)&&(r={key:r}),a.setChildTemplate(this.buildFromLayout(r))):e.items&&i.each(e.items,function(e){i.isString(e)&&(e={key:e}),a.appendChild(this.buildFromLayout(e))},this),a},E.prototype.computeInitialValues=function(){this.root.computeInitialValues(this.formDesc.value)},E.prototype.render=function(e){e&&(this.domRoot=e,this.root.render(),this.hasRequiredField()&&n(e).addClass("jsonform-hasrequired"))},E.prototype.forEachElement=function(e){var t=function(n){for(var i=0;i<n.children.length;i++)e(n.children[i]),t(n.children[i])};t(this.root)},E.prototype.validate=function(e){var i=m.getFormValue(this.domRoot),a=!1,l=this.formDesc;if(!1!==l.validate){var r=!1;if("object"!=typeof l.validate?t.JSONFormValidator&&(r=t.JSONFormValidator.createEnvironment("json-schema-draft-03")):r=l.validate,r){var s=r.validate(i,this.formDesc.schema);n(this.domRoot).jsonFormErrors(!1,l),s.errors.length&&(a||(a=[]),a=a.concat(s.errors))}}return a&&!e&&(l.displayErrors?l.displayErrors(a,this.domRoot):n(this.domRoot).jsonFormErrors(a,l)),{errors:a}},E.prototype.submit=function(e){var t=function(){return e&&(e.preventDefault(),e.stopPropagation()),!1},n=m.getFormValue(this.domRoot),i=this.formDesc,a=!1;if(this.forEachElement(function(t){a||t.view.onSubmit&&(a=!t.view.onSubmit(e,t))}),a)return t();var l=this.validate();return i.onSubmit&&!i.onSubmit(l.errors,n)?t():l.errors?t():!(!i.onSubmitValid||i.onSubmitValid(n))&&t()},E.prototype.hasRequiredField=function(){var e=function(t){if(!t)return null;if(t.required&&"boolean"!==t.type)return t;var n=i.find(t.properties,function(t){return e(t)});return n||(t.items&&(n=i.isArray(t.items)?i.find(t.items,function(t){return e(t)}):e(t.items),n)?n:void 0)};return e(this.formDesc.schema)},m.getFormValue=function(e){var t=n(e).data("jsonform-tree");return t?t.root.getFormValues():null},n.fn.jsonFormErrors=function(e,t){if(n(".error",this).removeClass("error"),n(".warning",this).removeClass("warning"),n(".jsonform-errortext",this).hide(),e){for(var i=[],a=0;a<e.length;a++){var l=e[a].uri.replace(/.*#\//,"").replace(/\//g,".").replace(/\.([0-9]+)(?=\.|$)/g,"[$1]"),r=".jsonform-error-"+h(l.replace(/\./g,"---"));i.push(r);var s=e[a].type||"error";n(r,this).addClass(s),n(r+" .jsonform-errortext",this).html(e[a].message).show()}i=i.join(",");var o=n(i).get(0);o&&o.scrollIntoView&&o.scrollIntoView(!0,{behavior:"smooth"})}},n.fn.jsonForm=function(e){var t=this;e=i.defaults({},e,{submitEvent:"submit"});var l=new E;return l.initialize(e),l.render(t.get(0)),e.transloadit&&t.append('<input type="hidden" name="params" value=\''+u(a.stringify(e.transloadit.params))+"'>"),t.data("jsonform-tree",l),e.submitEvent&&(t.unbind(e.submitEvent+".jsonform"),t.bind(e.submitEvent+".jsonform",function(e){l.submit(e)})),f(t),n(".expandable > div, .expandable > fieldset",t).hide(),t.on("click",".expandable > legend",function(){var e=n(this).parent();e.toggleClass("expanded"),e.find("legend").attr("aria-expanded",e.hasClass("expanded")),n("> div",e).slideToggle(100)}),l},n.fn.jsonFormValue=function(){return m.getFormValue(this)},t.JSONForm=t.JSONForm||{util:{}},t.JSONForm.getFormValue=m.getFormValue,t.JSONForm.fieldTemplate=m.fieldTemplate,t.JSONForm.fieldTypes=m.elementTypes,t.JSONForm.getInitialValue=x,t.JSONForm.util.getObjKey=m.util.getObjKey,t.JSONForm.util.setObjKey=m.util.setObjKey}("undefined"!=typeof exports,"undefined"!=typeof exports?exports:window,"undefined"!=typeof jQuery?jQuery:{fn:{}},"undefined"!=typeof _?_:null,JSON);